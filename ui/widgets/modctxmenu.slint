import { PopupBorder, Popup } from "../components/popup.slint";
import { ListView, Button, Palette } from "std-widgets.slint";
import { ModLogic, WindowLogic } from "../applogic.slint";
import { DivaModElement } from "../diva-types.slint";
export component ModCtxMenu {
    in-out property <DivaModElement> module;
    in-out property <Point> pos;
    in-out property <int> idx;
    in property <length> win-height;
    in property <length> win-width;
    popup-window := PopupWindow {
        x: -(win-width / 2) + pos.x;
        y: -(win-height / 2) + (pos.y - 20px);
        width: 100px;
        Rectangle {
            background: Palette.background;
            border-color: Palette.foreground;
            border-width: 1px;
            VerticalLayout {
                padding: 1px;
                width: 100px;
                Rectangle {
                    // forward-focus: e-ta;
                    height: 30px;
                    background: edit-ta.has-hover ? Palette.alternate-background : Palette.background;

                    edit-ta := TouchArea {
                        clicked => {
                            debug("Test");
                            WindowLogic.open-mod-editor(module, idx);
                        }
                        HorizontalLayout {
                            padding-left: 5px;
                            width: 100px;
                            Image {
                                y:5px;
                                source: @image-url("../assets/trash-can-solid.svg");
                                height: 20px;
                                vertical-alignment: center;
                                width: 20px;
                                colorize: Palette.foreground;
                            }

                            Text {
                                vertical-alignment: center;
                                horizontal-alignment: left;
                                text: "Edit";
                            }
                        }
                    }
                }

                Rectangle {
                    height: 30px;
                    background: delete-ta.has-hover ? Palette.alternate-background : Palette.background;
                    // bord
                    delete-ta := TouchArea {
                        clicked => {
                            ModLogic.delete-mod(module);
                        }
                    }

                    HorizontalLayout {
                        width: 100px;
                        padding-left: 5px;
                        Image {
                            y: 5px;
                            source: @image-url("../assets/trash-can-solid.svg");
                            vertical-alignment: center;
                            width: 20px;
                            height: 20px;
                            colorize: Palette.foreground;
                        }

                        Text {
                            // x: 5px;
                            // width: 95px;
                            horizontal-alignment: left;
                            vertical-alignment: center;
                            text: "Delete";
                        }
                    }
                }
            }
        }
    }

    // Rectangle {
    //     height: 30px;
    //     background: b-ta.has-hover ? Palette.alternate-background : Palette.background;
    //     b-ta := TouchArea {
    //         Text {
    //             horizontal-alignment: left;
    //             text: "Test";
    //         }

    //         pointer-event(e) => {
    //             if e.kind == PointerEventKind.down {
    //                 show({ }, {
    //                     x: (self.absolute-position.x + self.mouse-x)- 20px,
    //                     y: (self.absolute-position.y + self.mouse-y) - 100px
    //                 });
    //             }
    //         }
    //     }
    // }

    public function show(module: DivaModElement, idx: int, pos: Point) {

        self.pos = pos;
        self.module = module;
        self.idx = idx;
        popup-window.show();
    }
}
